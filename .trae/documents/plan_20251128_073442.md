# 实现计划

## 需求分析

用户希望实现以下功能：
1. 当从"未开启分时图"切换到"开启分时图"时，工具栏宽度自动计算为：当前宽度 / 0.25 * 0.75
2. 当从"开启分时图"切换到"未开启分时图"时，工具栏宽度自动计算为：当前宽度 / 0.75 * 0.25

## 实现思路

1. 修改 `settings.py` 中的 `on_show_chart_change` 方法，实现新的宽度计算逻辑
2. 确保在切换分时图显示状态时，按照用户要求的公式计算新宽度
3. 保存当前状态，用于正确计算宽度
4. 确保新宽度在合理范围内

## 关键代码修改

### 文件：`app/settings.py`

1. **修改 `on_show_chart_change` 方法**：
   - 添加当前状态判断
   - 实现新的宽度计算逻辑
   - 确保新宽度在合理范围内
   - 应用新宽度并更新配置

## 实现步骤

1. 检查当前分时图显示状态
2. 根据当前状态计算新宽度：
   - 未开启分时图 → 开启分时图：新宽度 = 当前宽度 / 0.25 * 0.75
   - 开启分时图 → 未开启分时图：新宽度 = 当前宽度 / 0.75 * 0.25
3. 确保新宽度至少为100px
4. 应用新宽度并更新配置
5. 重新创建UI以应用新宽度

## 预期效果

1. 当未开启分时图，工具栏宽度为100px时，开启分时图后宽度变为：100 / 0.25 * 0.75 = 300px（总宽度400px，分时图300px，股票信息100px）
2. 当开启分时图，工具栏宽度为400px时，关闭分时图后宽度变为：400 / 0.75 * 0.25 = 133.33px（约133px）

## 技术细节

- 确保在计算过程中使用浮点数，避免整数除法问题
- 确保新宽度至少为100px，以保证UI正常显示
- 正确保存和更新配置，确保设置持久化
- 重新创建UI以应用新的宽度设置