# 实现计划

## 1. 分析当前布局

当前分时图模式下，布局比例是固定的：
- 分时图区域：70%宽度
- 股票信息区域：30%宽度

## 2. 需求实现

### 需求1：根据股票信息的文字占用自动调节比例

**实现思路**：
1. 测量股票信息文字的实际宽度
2. 根据文字宽度动态调整分时图和股票信息的比例
3. 确保股票信息区域有足够的宽度显示完整内容
4. 分时图区域占据剩余宽度

**实现步骤**：
- 修改 `create_chart_mode` 方法，添加文字宽度测量逻辑
- 使用 `font.measure()` 方法测量股票名称、价格和涨跌幅的实际宽度
- 计算股票信息区域所需的最小宽度
- 动态调整分时图和股票信息的比例

### 需求2：切换分时图显示状态时按比例调整宽度

**实现思路**：
1. 当从显示分时图切换到不显示分时图时，宽度调整为原来总宽度 * 股票信息比例
2. 当从不显示分时图切换到显示分时图时，恢复到原来的总宽度
3. 保存当前的宽度比例，用于切换时的计算

**实现步骤**：
- 修改 `settings.py` 中的 `on_show_chart_change` 方法
- 添加宽度比例保存和恢复逻辑
- 当切换为不显示分时图时，计算新宽度并应用
- 当切换为显示分时图时，恢复原来的宽度

## 3. 关键代码修改

### 文件：`app/ui.py`

1. **修改 `create_chart_mode` 方法**：
   - 添加文字宽度测量逻辑
   - 动态计算股票信息区域宽度
   - 调整分时图区域宽度为剩余宽度

2. **修改 `update_label_layout` 方法**：
   - 添加文字宽度变化时的重新布局逻辑
   - 当股票信息文字变化时，重新计算布局比例

### 文件：`app/settings.py`

1. **修改 `on_show_chart_change` 方法**：
   - 添加宽度比例保存逻辑
   - 当切换为不显示分时图时，计算新宽度 = 原宽度 * 股票信息比例
   - 当切换为显示分时图时，恢复原宽度

## 4. 预期效果

1. **自动调节比例**：
   - 股票信息区域宽度根据文字内容自动调整
   - 分时图区域占据剩余宽度
   - 确保股票信息完整显示，不被截断

2. **切换时宽度调整**：
   - 显示分时图 → 不显示分时图：宽度 = 原宽度 * 股票信息比例
   - 不显示分时图 → 显示分时图：恢复原宽度
   - 宽度调整平滑，不影响用户体验

## 5. 实现顺序

1. 首先实现需求1：根据股票信息文字占用自动调节比例
2. 然后实现需求2：切换分时图显示状态时按比例调整宽度
3. 测试功能是否正常工作
4. 优化用户体验，确保宽度调整平滑